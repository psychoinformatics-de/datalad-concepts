#!/bin/bash
#
# This script applies patches to the active linkml installation.
# It is to be executed in the root of the repository.
#

# Create correct 'order' properties when generating SHACL
patch -d $(python -c 'import os; import linkml.generators.shaclgen as m; print(os.path.dirname(m.__file__))') < patches/shaclgen_annotations.diff
# Honor type-designator slots when loading graphs
patch -d $(python -c 'import os; import linkml_runtime.loaders as m; print(os.path.dirname(m.__file__))') < patches/rdflib_loader_typedesignator.diff
# Use correct constructor arguments when normalizing inlined objects
patch -d $(python -c 'import os; import linkml_runtime.utils.yamlutils as m; print(os.path.dirname(m.__file__))') < patches/linkml_runtime_utils_yamlutils.diff
# Use `&` to separate multiple interfaces in graphql schemas
patch -d $(python -c 'import os; import linkml.generators.graphqlgen as m; print(os.path.dirname(m.__file__))') < patches/graphqlgen_interface_list.diff
# Do not emit python/rdflib upper case namespaces in `ifabsent`-default values
patch -d $(python -c 'import os; import linkml.generators.common.ifabsent_processor as m; print(os.path.dirname(m.__file__))') < patches/linkml_generators_common_ifabsent.diff
# Support explicit type clauses with schema defined types when loading ttl
patch -d $(python -c 'import os; import linkml_runtime.loaders as m; print(os.path.dirname(m.__file__))') < patches/rdflib_loader_custom_types.diff
# Order type expressions that are emitted by gen-python correctly
patch -d $(python -c 'import os; import linkml.generators.pythongen as m; print(os.path.dirname(m.__file__))') < patches/pythongen_type_reference_order.diff
